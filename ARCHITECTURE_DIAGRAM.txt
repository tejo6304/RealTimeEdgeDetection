================================================================================
                    JNI ARCHITECTURE DIAGRAM
================================================================================

┌─────────────────────────────────────────────────────────────────────────────┐
│                         ANDROID APPLICATION LAYER                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────────┐         ┌──────────────────────────┐             │
│  │   MainActivity.java   │         │  RealtimeFrameProcessor  │             │
│  ├──────────────────────┤         ├──────────────────────────┤             │
│  │ • Camera management  │         │ • Frame handling        │             │
│  │ • UI controls        │         │ • Real-time processing  │             │
│  │ • Filter switching   │         │ • Preview updates       │             │
│  │ • Image capture      │         │ • Performance tracking  │             │
│  └──────────────────────┘         └──────────────────────────┘             │
│           │                                  │                             │
│           └──────────────┬───────────────────┘                             │
│                          │                                                 │
│        ┌─────────────────┴────────────────────┐                            │
│        │  Android Camera2 / CameraX API       │                            │
│        │  - Frame capture                     │                            │
│        │  - Preview rendering                 │                            │
│        │  - Image storage                     │                            │
│        └─────────────────┬────────────────────┘                            │
│                          │                                                 │
└──────────────────────────┼─────────────────────────────────────────────────┘
                           │ JNI Boundary
                           │
┌──────────────────────────┼─────────────────────────────────────────────────┐
│                NATIVE LAYER (C++ via JNI)                                  │
├──────────────────────────┼─────────────────────────────────────────────────┤
│                          │                                                 │
│        ┌─────────────────▼──────────────────────────┐                      │
│        │  JNI Method Wrapper Layer                  │                      │
│        ├────────────────────────────────────────────┤                      │
│        │ • notifyFilterChange()                     │                      │
│        │ • processBitmap()                          │                      │
│        │ • processNV21Frame()                       │                      │
│        │ • processRGBAFrame()                       │                      │
│        │ • processBatchNV21()                       │                      │
│        │ • getPerformanceMetrics()                  │                      │
│        │ • cleanup()                                │                      │
│        └─────────────────┬──────────────────────────┘                      │
│                          │                                                 │
│        ┌─────────────────▼──────────────────────────┐                      │
│        │  Image Processing Pipeline                │                      │
│        ├────────────────────────────────────────────┤                      │
│        │ • YUV ↔ RGBA Conversion                   │                      │
│        │ • Bitmap ↔ Mat Conversion                 │                      │
│        │ • Filter Application                       │                      │
│        │ • Thread-safe Processing                  │                      │
│        └─────────────────┬──────────────────────────┘                      │
│                          │                                                 │
│        ┌─────────────────▼──────────────────────────┐                      │
│        │  Filter Implementations                    │                      │
│        ├────────────────────────────────────────────┤                      │
│        │                                            │                      │
│  ┌─────┴──────────────────────────────────────┐    │                      │
│  │                                            │    │                      │
│  ▼                                            ▼    │                      │
│ ┌──────────────────┐     ┌──────────────────┐    │ │                      │
│ │    Grayscale     │     │   Canny Edge     │    │ │                      │
│ │   (Filter 0)     │     │  (Filter 1)      │    │ │                      │
│ ├──────────────────┤     ├──────────────────┤    │ │                      │
│ │cvtColor(RGBA→G)  │     │GaussianBlur()    │    │ │                      │
│ │cvtColor(G→RGBA)  │     │Canny(50, 150)    │    │ │                      │
│ └──────────────────┘     │cvtColor(G→RGBA)  │    │ │                      │
│                          └──────────────────┘    │ │                      │
│                                                  │ │                      │
│        ┌───────────────────────────────────┘    │                         │
│        │                                         │                         │
│        └─────────────────┬─────────────────────────┘                       │
│                          │                                                 │
│        ┌─────────────────▼──────────────────────────┐                      │
│        │  OpenCV Library Integration                │                      │
│        ├────────────────────────────────────────────┤                      │
│        │ • Core (Mat, memory management)            │                      │
│        │ • ImgProc (filters, transforms)            │                      │
│        │ • Optimized operations (SIMD)              │                      │
│        └────────────────────────────────────────────┘                      │
│                                                                            │
│        ┌────────────────────────────────────────────┐                      │
│        │  Thread Safety & Synchronization            │                      │
│        ├────────────────────────────────────────────┤                      │
│        │ • std::mutex frameMutex                     │                      │
│        │ • std::mutex queueMutex                     │                      │
│        │ • std::condition_variable frameAvailable   │                      │
│        │ • std::lock_guard<> RAII locking           │                      │
│        └────────────────────────────────────────────┘                      │
│                                                                            │
│        ┌────────────────────────────────────────────┐                      │
│        │  Memory Management                         │                      │
│        ├────────────────────────────────────────────┤                      │
│        │ • AndroidBitmap API (pixel access)         │                      │
│        │ • cv::Mat (OpenCV memory)                  │                      │
│        │ • std::vector (frame data)                 │                      │
│        │ • std::shared_ptr (frame queue)            │                      │
│        │ • EGL/GLuint (GPU resources)               │                      │
│        └────────────────────────────────────────────┘                      │
│                                                                            │
│        ┌────────────────────────────────────────────┐                      │
│        │  Performance Monitoring                     │                      │
│        ├────────────────────────────────────────────┤                      │
│        │ • frameCount tracking                       │                      │
│        │ • frameProcessingTimeMs accumulation        │                      │
│        │ • FPS calculation                           │                      │
│        │ • Per-frame statistics                      │                      │
│        └────────────────────────────────────────────┘                      │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘
                           │ JNI Return
                           │
┌──────────────────────────┼─────────────────────────────────────────────────┐
│                    RETURN TO JAVA/KOTLIN                                   │
├──────────────────────────┼─────────────────────────────────────────────────┤
│                          │                                                 │
│        ┌─────────────────▼──────────────────────────┐                      │
│        │  Result Handling                           │                      │
│        ├────────────────────────────────────────────┤                      │
│        │ • Processed Bitmap returned                │                      │
│        │ • Byte array results                       │                      │
│        │ • Statistics returned                      │                      │
│        │ • Error states handled                     │                      │
│        └────────────────────────────────────────────┘                      │
│                                                                            │
└────────────────────────────────────────────────────────────────────────────┘

================================================================================
                         DATA FLOW - CAMERA FRAME
================================================================================

Camera Input (NV21)
       │
       ▼
┌─────────────────────┐
│  ImageReader        │ (YUV420SP/NV21 format)
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  JNI Interface      │
│ processNV21Frame()  │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Convert NV21→RGBA  │
│  cv::cvtColor()     │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Apply Filter       │
│  • Grayscale        │
│  • Canny Edge       │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Return RGBA Bytes  │
│  Display in Preview │
└──────────┬──────────┘
           │
           ▼
     UI Updates

================================================================================
                         DATA FLOW - IMAGE CAPTURE
================================================================================

Camera Bitmap (RGBA)
       │
       ▼
┌─────────────────────┐
│  ImageStorageUtils  │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  JNI Interface      │
│ processBitmap()     │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Lock Bitmap Pixels │
│  AndroidBitmap API  │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Convert to Mat     │
│  Apply Filter       │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Copy Back to Bitmap│
│  Unlock Pixels      │
└──────────┬──────────┘
           │
           ▼
┌─────────────────────┐
│  Save to Storage    │
│  Display Result     │
└─────────────────────┘

================================================================================
                      FILTER PROCESSING PIPELINE
================================================================================

┌─────────────────┐
│  Input Image    │ (Any format/size)
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────────┐
│  Format Normalization               │
│  • Ensure RGBA format               │
│  • Handle dimension alignment       │
└────────┬────────────────────────────┘
         │
         ▼
    ┌────┴────┐
    │          │
    ▼          ▼
┌────────┐  ┌─────────────┐
│  Type  │  │    Other    │
│  0     │  │   Types     │
│        │  │             │
▼        │  └─────────────┘
Grayscale│
│        │
├────────┘
│
▼
┌──────────────────────────┐
│  OpenCV Processing       │
│  cvtColor() operations   │
└──────────┬───────────────┘
           │
           ▼
┌──────────────────────────┐
│  Result Validation       │
│  • Check dimensions      │
│  • Verify format         │
│  • Ensure continuity     │
└──────────┬───────────────┘
           │
           ▼
┌──────────────────────────┐
│  Memory Copy to Output   │
│  memcpy() / SetByteArray │
└──────────┬───────────────┘
           │
           ▼
┌──────────────────────────┐
│  Result Output           │
│  (Bitmap/Byte Array)     │
└──────────────────────────┘

================================================================================
                    THREAD SAFETY ARCHITECTURE
================================================================================

                    ┌─────────────────────┐
                    │  Main Application   │
                    │  Thread (UI)        │
                    └────────┬────────────┘
                             │ (1)
                    ┌────────▼────────────┐
                    │ Filter Change       │
                    │ Notification        │
                    └────────┬────────────┘
                             │ JNI Call
                    ┌────────▼────────────┐
                    │ Acquire frameMutex  │
                    └────────┬────────────┘
                             │
                    ┌────────▼────────────┐
                    │ Update Filter Type  │
                    │ (currentFilterType) │
                    └────────┬────────────┘
                             │
                    ┌────────▼────────────┐
                    │ Release frameMutex  │
                    └────────┬────────────┘
                             │
                    ┌────────▼────────────┐
                    │ Return to Java      │
                    └─────────────────────┘

                    ┌─────────────────────┐
                    │ Camera Callback     │
                    │ Thread              │
                    └────────┬────────────┘
                             │ (2)
                    ┌────────▼────────────┐
                    │ New Frame Available │
                    └────────┬────────────┘
                             │ JNI Call
                    ┌────────▼────────────┐
                    │ Acquire queueMutex  │
                    └────────┬────────────┘
                             │
                    ┌────────▼────────────┐
                    │ Add to Frame Queue  │
                    └────────┬────────────┘
                             │
                    ┌────────▼────────────┐
                    │ Signal frameAvail.  │
                    └────────┬────────────┘
                             │
                    ┌────────▼────────────┐
                    │ Release queueMutex  │
                    └──────────┬──────────┘
                               │
                    ┌──────────▼──────────┐
                    │ Return Processed    │
                    │ Frame to UI         │
                    └─────────────────────┘

================================================================================
                    BUILD & DEPLOYMENT PIPELINE
================================================================================

Source Code
    │
    ├─ Java/Kotlin (.java, .kt)
    │       │
    │       ▼
    │  ┌──────────────────┐
    │  │ Java Compiler    │
    │  │ (javac)          │
    │  └────────┬─────────┘
    │           │
    │           ▼
    │  ┌──────────────────┐
    │  │ .class files     │
    │  └────────┬─────────┘
    │           │
    │           └──────────┐
    │                      │
    ├─ C++ (.cpp, .h)      │
    │       │              │
    │       ▼              │
    │  ┌──────────────────┐
    │  │ CMake            │
    │  │ (build system)   │
    │  └────────┬─────────┘
    │           │
    │           ▼
    │  ┌──────────────────┐
    │  │ NDK Compiler     │
    │  │ (Clang)          │
    │  └────────┬─────────┘
    │           │
    │           ▼
    │  ┌──────────────────┐
    │  │ .so Libraries    │
    │  │ (4 ABIs)         │
    │  └────────┬─────────┘
    │           │
    └──────────┬┘
               │
               ▼
        ┌─────────────────┐
        │ Gradle Packager │
        └────────┬────────┘
                 │
                 ▼
        ┌─────────────────┐
        │ APK File        │
        │ (signed)        │
        └────────┬────────┘
                 │
                 ▼
        ┌─────────────────┐
        │ Install via ADB │
        │ (Device)        │
        └────────┬────────┘
                 │
                 ▼
        ┌─────────────────┐
        │ Running App     │
        │ (Ready for use) │
        └─────────────────┘

================================================================================
                    SUPPORTED PLATFORMS
================================================================================

Android NDK:
  ┌─────────────────────────────────────────┐
  │ ARM64 (arm64-v8a)    - Primary          │
  │ ARM32 (armeabi-v7a)  - Wide support     │
  │ x86                  - Emulator          │
  │ x86_64               - Emulator/Tablet   │
  └─────────────────────────────────────────┘

Android API Levels:
  ┌─────────────────────────────────────────┐
  │ Target: API 34+ (Android 14+)            │
  │ Minimum: API 21 (Android 5.0)            │
  │ Tested: API 33, 34, 35                   │
  └─────────────────────────────────────────┘

Dependencies:
  ┌─────────────────────────────────────────┐
  │ OpenCV 4.x                               │
  │ Android NDK r23+                         │
  │ CMake 3.16+                              │
  │ Gradle 8.0+                              │
  └─────────────────────────────────────────┘

================================================================================
